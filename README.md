# API REST de Biblioteca üìö

Una API completa para gesti√≥n de biblioteca desarrollada en PHP y MySQL, dise√±ada especialmente para que los estudiantes aprendan a consumir APIs usando POSTMAN. Incluye detecci√≥n autom√°tica de entorno, estad√≠sticas avanzadas y endpoints de verificaci√≥n.

## ‚ú® Caracter√≠sticas

- ‚úÖ **CRUD completo** para gesti√≥n de libros
- ‚úÖ **Detecci√≥n autom√°tica de entorno** (local/producci√≥n)
- ‚úÖ **Estad√≠sticas din√°micas** en tiempo real
- ‚úÖ **Endpoints de verificaci√≥n** de autores y g√©neros
- ‚úÖ **Filtros avanzados** para b√∫squedas
- ‚úÖ **Ejemplos de errores** para aprendizaje
- ‚úÖ **Documentaci√≥n interactiva** con URLs de prueba
- ‚úÖ **Colecci√≥n de POSTMAN** incluida
- ‚úÖ **Sin dependencia de .htaccess**

## üöÄ Configuraci√≥n Inicial

### 1. Configurar Base de Datos

1. Abrir WAMP/XAMPP
2. Acceder a phpMyAdmin
3. Ejecutar el script `database.sql` para crear la base de datos y datos de ejemplo

### 2. Configurar la API

1. Verificar que los archivos est√©n en `C:\wamp64\www\APILibrary\`
2. Asegurase que WAMP est√© corriendo
3. La API estar√° disponible en: `http://localhost/APILibrary/`

### 3. Verificar Funcionamiento

Accede a `http://localhost/APILibrary/` para ver la documentaci√≥n interactiva con URLs de prueba autom√°ticamente generadas seg√∫n tu entorno.

## üì° Endpoints Disponibles

### Informaci√≥n de la API

```
GET http://localhost/APILibrary/
```

### Gesti√≥n de Libros

| M√©todo | Endpoint                 | Descripci√≥n              |
| ------ | ------------------------ | ------------------------ |
| GET    | `/index.php/libros`      | Obtener todos los libros |
| GET    | `/index.php/libros/{id}` | Obtener libro espec√≠fico |
| POST   | `/index.php/libros`      | Crear nuevo libro        |
| PUT    | `/index.php/libros/{id}` | Actualizar libro         |
| DELETE | `/index.php/libros/{id}` | Eliminar libro           |

### Estad√≠sticas y An√°lisis

| M√©todo | Endpoint                           | Descripci√≥n                          |
| ------ | ---------------------------------- | ------------------------------------ |
| GET    | `/index.php/stats`                 | Estad√≠sticas completas de biblioteca |
| GET    | `/index.php/check-author/{nombre}` | Verificar si existe un autor         |
| GET    | `/index.php/check-genre/{nombre}`  | Verificar si existe un g√©nero        |
| GET    | `/index.php/author-info/{nombre}`  | Informaci√≥n detallada de un autor    |

### Ejemplos de Errores (Para Aprendizaje)

| M√©todo | Endpoint               | Error                 |
| ------ | ---------------------- | --------------------- |
| GET    | `/index.php/error/400` | Bad Request           |
| GET    | `/index.php/error/401` | Unauthorized          |
| GET    | `/index.php/error/403` | Forbidden             |
| GET    | `/index.php/error/404` | Not Found             |
| GET    | `/index.php/error/500` | Internal Server Error |

## üìñ Ejemplos Pr√°cticos para POSTMAN

### 1. Obtener Informaci√≥n de la API

```
GET http://localhost/APILibrary/
```

### 2. Obtener Todos los Libros

```
GET http://localhost/APILibrary/index.php/libros
```

### 3. Obtener Libros con Filtros

```
GET http://localhost/APILibrary/index.php/libros?genero=Realismo m√°gico
GET http://localhost/APILibrary/index.php/libros?autor=Garc√≠a M√°rquez
GET http://localhost/APILibrary/index.php/libros?disponible=true
GET http://localhost/APILibrary/index.php/libros?a√±o_desde=1950&a√±o_hasta=2000
GET http://localhost/APILibrary/index.php/libros?genero=Novela&disponible=false
```

### 4. Obtener Libro Espec√≠fico

```
GET http://localhost/APILibrary/index.php/libros/1
GET http://localhost/APILibrary/index.php/libros/5
```

### 5. Crear Nuevo Libro

```
POST http://localhost/APILibrary/index.php/libros
Content-Type: application/json

{
    "titulo": "El nombre del viento",
    "autor": "Patrick Rothfuss",
    "isbn": "9788401352836",
    "genero": "Fantas√≠a",
    "a√±o_publicacion": 2007,
    "disponible": true
}
```

### 6. Actualizar Libro

```
PUT http://localhost/APILibrary/index.php/libros/13
Content-Type: application/json

{
    "disponible": false,
    "genero": "Fantas√≠a √©pica"
}
```

### 7. Eliminar Libro

```
DELETE http://localhost/APILibrary/index.php/libros/13
```

### 8. Obtener Estad√≠sticas

```
GET http://localhost/APILibrary/index.php/stats
```

**Respuesta incluye:**

- Total de libros y disponibilidad
- Conteo de g√©neros y autores √∫nicos
- Top 10 autores con m√°s libros
- Lista completa de todos los autores
- Lista completa de todos los g√©neros
- Distribuci√≥n de libros por d√©cada

### 9. Verificar Existencia de Autor

```
GET http://localhost/APILibrary/index.php/check-author/Garc√≠a M√°rquez
GET http://localhost/APILibrary/index.php/check-author/J.K. Rowling
```

### 10. Verificar Existencia de G√©nero

```
GET http://localhost/APILibrary/index.php/check-genre/Realismo m√°gico
GET http://localhost/APILibrary/index.php/check-genre/Ciencia ficci√≥n
```

### 11. Informaci√≥n Detallada de Autor

```
GET http://localhost/APILibrary/index.php/author-info/Garc√≠a M√°rquez
```

**Respuesta incluye:**

- Total de libros del autor
- Libros disponibles
- Primer y √∫ltimo a√±o de publicaci√≥n
- G√©neros en los que escribe

## ‚ùå Ejemplos de Errores para Practicar

### Error 400 - Bad Request

```
GET http://localhost/APILibrary/index.php/error/400
```

### Error 401 - Unauthorized

```
GET http://localhost/APILibrary/index.php/error/401
```

### Error 403 - Forbidden

```
GET http://localhost/APILibrary/index.php/error/403
```

### Error 404 - Not Found

```
GET http://localhost/APILibrary/index.php/error/404
```

### Error 500 - Internal Server Error

```
GET http://localhost/APILibrary/index.php/error/500
```

## üß™ Ejercicios para Practicar con POSTMAN

### Ejercicio 1: Operaciones B√°sicas

1. Obtener la informaci√≥n de la API
2. Listar todos los libros
3. Obtener el libro con ID 3
4. Crear un nuevo libro de tu autor favorito
5. Actualizar la disponibilidad del libro creado
6. Eliminar el libro creado

### Ejercicio 2: Filtros y B√∫squedas

1. Buscar todos los libros de "Gabriel Garc√≠a M√°rquez"
2. Obtener solo los libros disponibles
3. Filtrar libros del g√©nero "Realismo m√°gico"
4. Buscar libros publicados entre 1960 y 1990
5. Combinar filtros: libros de fantas√≠a disponibles

### Ejercicio 3: Estad√≠sticas y Verificaciones

1. Obtener estad√≠sticas completas de la biblioteca
2. Verificar si existe el autor "Antoine de Saint-Exupery"
3. Verificar si existe el g√©nero "Literatura infantil"
4. Obtener informaci√≥n detallada de "Garc√≠a M√°rquez"
5. Agregar un nuevo libro y verificar que las estad√≠sticas se actualicen

### Ejercicio 4: Manejo de Errores

1. Intentar obtener un libro con ID que no existe (ej: 999)
2. Crear un libro sin campos obligatorios
3. Crear un libro con ISBN duplicado
4. Actualizar un libro que no existe
5. Probar todos los endpoints de ejemplo de errores

### Ejercicio 5: Validaciones

1. Crear un libro con a√±o de publicaci√≥n inv√°lido (ej: 2030)
2. Crear un libro con ISBN de formato incorrecto
3. Intentar actualizar con campos demasiado largos
4. Enviar JSON malformado

### Ejercicio 6: Flujo Completo de Verificaci√≥n

1. Verificar si existe un autor antes de agregarlo
2. Crear un libro con un autor nuevo
3. Verificar que el autor ahora existe
4. Obtener informaci√≥n detallada del nuevo autor
5. Verificar que las estad√≠sticas reflejen el cambio

## üì• Colecci√≥n de POSTMAN

Puedes importar esta colecci√≥n en POSTMAN:

```json
{
  "info": {
    "name": "Biblioteca API",
    "description": "Colecci√≥n completa para la API de Biblioteca"
  },
  "item": [
    {
      "name": "Info API",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/"
      }
    },
    {
      "name": "Obtener Todos los Libros",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/libros"
      }
    },
    {
      "name": "Obtener Libro por ID",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/libros/1"
      }
    },
    {
      "name": "Crear Libro",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"titulo\": \"Nuevo Libro\",\n    \"autor\": \"Autor Ejemplo\",\n    \"isbn\": \"9781234567890\",\n    \"genero\": \"Ficci√≥n\",\n    \"a√±o_publicacion\": 2023,\n    \"disponible\": true\n}"
        },
        "url": "http://localhost/APILibrary/libros"
      }
    },
    {
      "name": "Actualizar Libro",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"disponible\": false\n}"
        },
        "url": "http://localhost/APILibrary/libros/1"
      }
    },
    {
      "name": "Eliminar Libro",
      "request": {
        "method": "DELETE",
        "header": [],
        "url": "http://localhost/APILibrary/libros/1"
      }
    },
    {
      "name": "Estad√≠sticas",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/stats"
      }
    },
    {
      "name": "Verificar Autor",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/check-author/Garc√≠a M√°rquez"
      }
    },
    {
      "name": "Verificar G√©nero",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/check-genre/Realismo m√°gico"
      }
    },
    {
      "name": "Info del Autor",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/author-info/Garc√≠a M√°rquez"
      }
    },
    {
      "name": "Error 400",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/error/400"
      }
    },
    {
      "name": "Error 404",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost/APILibrary/error/404"
      }
    }
  ]
}
```

## üîß Estructura de Respuestas

Todas las respuestas siguen este formato est√°ndar:

### Respuesta Exitosa

```json
{
  "status": "success",
  "timestamp": "2024-01-01T12:00:00+00:00",
  "api_version": "1.0",
  "message": "Operaci√≥n exitosa",
  "data": {
    // Datos solicitados
  }
}
```

### Respuesta de Error

```json
{
  "status": "error",
  "timestamp": "2024-01-01T12:00:00+00:00",
  "api_version": "1.0",
  "message": "Descripci√≥n del error",
  "error": {
    "code": "ERROR_CODE",
    "details": "Detalles espec√≠ficos del error"
  }
}
```

## üìö Esquema de Base de Datos

### Tabla: libros

| Campo               | Tipo         | Descripci√≥n          |
| ------------------- | ------------ | -------------------- |
| id                  | INT (PK, AI) | Identificador √∫nico  |
| titulo              | VARCHAR(255) | T√≠tulo del libro     |
| autor               | VARCHAR(255) | Autor del libro      |
| isbn                | VARCHAR(13)  | ISBN √∫nico           |
| genero              | VARCHAR(100) | G√©nero literario     |
| a√±o_publicacion     | YEAR         | A√±o de publicaci√≥n   |
| disponible          | BOOLEAN      | Disponibilidad       |
| fecha_registro      | TIMESTAMP    | Fecha de creaci√≥n    |
| fecha_actualizacion | TIMESTAMP    | √öltima actualizaci√≥n |

## üéØ Objetivos de Aprendizaje

Al usar esta API, los estudiantes aprender√°n:

1. **M√©todos HTTP**: GET, POST, PUT, DELETE
2. **C√≥digos de Estado**: 200, 201, 400, 401, 403, 404, 500
3. **Headers**: Content-Type, Accept
4. **Formato JSON**: Estructura de datos
5. **Par√°metros**: Query params y path params
6. **Manejo de Errores**: Diferentes tipos y respuestas
7. **Validaciones**: Campos obligatorios y formatos
8. **Filtros**: B√∫squedas y consultas espec√≠ficas

## üîß Soluci√≥n de Problemas

### Error de Conexi√≥n

- Verificar que WAMP est√© ejecut√°ndose
- Confirmar que MySQL est√© activo
- Revisar credenciales en `config.php`

### Error 404 en API

- Verificar la URL base: `http://localhost/APILibrary/`
- Asegurar que los archivos est√©n en la carpeta correcta

### Error de Base de Datos

- Ejecutar el script `database.sql`
- Verificar que la base de datos `biblioteca_api` exista
- Confirmar que la tabla `libros` tenga datos

## üë®‚Äçüè´ Para Profesores

Esta API est√° dise√±ada para ense√±ar:

- Conceptos fundamentales de APIs REST
- Uso pr√°ctico de POSTMAN
- Diferentes tipos de errores HTTP
- Validaciones y manejo de datos
- Operaciones CRUD completas
- An√°lisis de estad√≠sticas din√°micas
- Verificaci√≥n de existencia de datos

Los ejemplos progresivos permiten avanzar desde conceptos b√°sicos hasta manejo avanzado de errores y validaciones.

## üöÄ Despliegue en Producci√≥n

### 1. Preparaci√≥n del Servidor

#### Requisitos del Servidor

- **PHP 7.4 o superior** (recomendado PHP 8.0+)
- **MySQL 5.7 o superior** / **MariaDB 10.2+**
- **Apache** con mod_rewrite habilitado
- **Extensiones PHP**: PDO, PDO_MySQL, JSON

#### Verificar Requisitos

```bash
php -v
mysql --version
php -m | grep -E "pdo|json"
```

### 2. Configuraci√≥n del Dominio y Hosting

#### Opciones de Hosting Recomendadas

- **Hostinger** (econ√≥mico, buen soporte PHP)
- **SiteGround** (rendimiento optimizado)
- **DigitalOcean** (VPS para mayor control)
- **000webhost** (gratuito para pruebas)

#### Subir Archivos al Servidor

1. Comprimir la carpeta `APILibrary` en un archivo ZIP
2. Subir mediante FTP/cPanel File Manager al directorio `public_html`
3. Extraer los archivos directamente en `public_html` o en una subcarpeta

### 3. Configuraci√≥n de Base de Datos en Producci√≥n

#### Crear Base de Datos en cPanel/Hosting

```sql
-- En phpMyAdmin del hosting:
CREATE DATABASE nombre_usuario_biblioteca_api;
```

#### Ejecutar Script de Base de Datos

1. Acceder a phpMyAdmin del hosting
2. Seleccionar la base de datos creada
3. Importar el archivo `database.sql`
4. Verificar que la tabla `libros` se cre√≥ con datos

### 4. Configuraci√≥n Autom√°tica de Entorno

La API detecta autom√°ticamente el entorno:

```php
// environment.php - Detecci√≥n autom√°tica
function detectEnvironment() {
    $host = $_SERVER['HTTP_HOST'] ?? 'localhost';

    if (strpos($host, 'localhost') !== false ||
        strpos($host, '127.0.0.1') !== false) {
        return 'local';
    }
    return 'production';
}
```

#### Configurar Credenciales de Producci√≥n

Editar `environment.php` si es necesario:

```php
case 'production':
    return [
        'host' => 'localhost', // O IP del servidor de BD
        'dbname' => 'tu_usuario_biblioteca_api',
        'username' => 'tu_usuario_db',
        'password' => 'tu_password_db',
        'charset' => 'utf8mb4'
    ];
```

### 5. URLs de Producci√≥n

Una vez desplegado, las URLs ser√°n:

```
https://tudominio.com/APILibrary/
https://tudominio.com/APILibrary/index.php/libros
https://tudominio.com/APILibrary/index.php/stats
```

La API genera autom√°ticamente las URLs correctas seg√∫n el entorno detectado.

### 6. Verificaci√≥n del Despliegue

#### Test B√°sico

```bash
curl https://tudominio.com/APILibrary/
```

#### Verificar Funcionalidad

1. Acceder a `https://tudominio.com/APILibrary/`
2. Probar los enlaces de la documentaci√≥n
3. Verificar que las URLs se generan correctamente
4. Probar operaciones CRUD desde POSTMAN

### 7. Configuraci√≥n de Seguridad (Opcional)

#### Limitar Acceso por IP (si es necesario)

```apache
# En .htaccess (si lo usas)
<RequireAll>
    Require ip 192.168.1.0/24
    Require ip 10.0.0.0/8
</RequireAll>
```

#### Headers de Seguridad Adicionales

```php
// En config.php, agregar al funci√≥n setCorsHeaders():
header('X-Content-Type-Options: nosniff');
header('X-Frame-Options: DENY');
header('X-XSS-Protection: 1; mode=block');
```

### 8. Monitoreo y Logs

#### Habilitar Logs de Errores PHP

```php
// En environment.php para producci√≥n:
if ($env === 'production') {
    ini_set('log_errors', 1);
    ini_set('error_log', '/path/to/error.log');
    ini_set('display_errors', 0);
}
```

#### Monitorear Base de Datos

```sql
-- Verificar conexiones activas
SHOW PROCESSLIST;

-- Verificar performance
SHOW STATUS LIKE 'Threads_connected';
```

### 9. Backup y Mantenimiento

#### Backup Autom√°tico de Base de Datos

```bash
# Script de backup (ejecutar via cron)
mysqldump -u usuario -p biblioteca_api > backup_$(date +%Y%m%d).sql
```

#### Actualizaciones

1. Backup de archivos y BD
2. Subir nuevos archivos
3. Verificar funcionamiento
4. Actualizar documentaci√≥n si es necesario

### 10. Soluci√≥n de Problemas en Producci√≥n

#### Error 500 - Internal Server Error

```bash
# Verificar logs de error
tail -f /path/to/error.log

# Verificar permisos
chmod 644 *.php
chmod 755 .
```

#### Error de Conexi√≥n a BD

```php
// Verificar credenciales en environment.php
// Verificar que la BD est√© activa
// Comprobar l√≠mites de conexiones del hosting
```

#### URLs Incorrectas

```php
// La detecci√≥n autom√°tica deber√≠a funcionar
// Verificar $_SERVER['HTTP_HOST'] en environment.php
```

## üìä Estad√≠sticas de Uso

### M√©tricas que Puedes Rastrear

- N√∫mero total de requests por endpoint
- Libros m√°s consultados
- Autores m√°s buscados
- Errores m√°s frecuentes
- Filtros m√°s utilizados

### Implementar Logging (Opcional)

```php
// En Database.php, agregar a cada m√©todo:
error_log("API Call: {$method} {$endpoint} at " . date('Y-m-d H:i:s'));
```

## üîÑ Actualizaciones y Versionado

### Versi√≥n Actual: 1.0

- ‚úÖ CRUD completo de libros
- ‚úÖ Estad√≠sticas avanzadas
- ‚úÖ Endpoints de verificaci√≥n
- ‚úÖ Detecci√≥n autom√°tica de entorno
- ‚úÖ Documentaci√≥n interactiva

### Pr√≥ximas Mejoras Sugeridas

- üîú Autenticaci√≥n con tokens
- üîú Paginaci√≥n para listados grandes
- üîú Cache de estad√≠sticas
- üîú Rate limiting
- üîú Logs de auditor√≠a
